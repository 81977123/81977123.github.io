<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ–‡ä»¶ç›®å½•æ ‘ Â· æ ‘å¹²ç²—ç»†ä½“ç°æ–‡ä»¶æ•°é‡ + åœ†è§’æœ«ç«¯</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-color: #faf8f2;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .tree-container {
            background: #fefdf7;
            border-radius: 40px 40px 20px 20px;
            box-shadow: 0 20px 30px rgba(60, 40, 20, 0.3);
            padding: 20px;
        }
        .title {
            font-size: 42px;
            font-weight: 500;
            fill: #3a2c1b;
        }
        .subtitle {
            font-size: 18px;
            fill: #6b4f35;
        }
        .footer {
            font-size: 16px;
            fill: #8b7a62;
        }
        /* è¿çº¿ â€”â€” åŠ¨æ€ç²—ç»†åœ¨JSä¸­è®¾ç½®ï¼Œåœ†è§’æœ«ç«¯ */
        .link {
            fill: none;
            stroke: #b68b6e;
            stroke-opacity: 0.7;
            transition: stroke-opacity 0.2s;
            stroke-linecap: round;  /* ä½¿æå¹²æœ«ç«¯å˜æˆåœ†è§’ */
        }
        /* èŠ‚ç‚¹ç»„ */
        .node {
            cursor: default;
        }
        /* æ–‡ä»¶èŠ‚ç‚¹ç»„ï¼šå¯ç‚¹å‡» */
        .node.file {
            cursor: pointer;
        }
        /* èŠ‚ç‚¹åœ†åœˆ */
        .node-circle {
            fill: #7d9b76;
            stroke: #fff8e7;
            stroke-width: 3px;
            filter: drop-shadow(2px 4px 4px rgba(0,0,0,0.2));
        }
        .node.file .node-circle {
            fill: #e9b56c;
            stroke: #ffecb3;
            stroke-width: 4px;
            filter: drop-shadow(0 0 8px #f7d45a);
        }
        .source-circle {
            fill: #a5682a;
            stroke: #fbe49b;
            stroke-width: 6px;
            filter: drop-shadow(0 0 10px #fabc60);
        }
        .node-label {
            font-size: 18px;
            fill: #2c3e2b;
            font-weight: 500;
            text-shadow: 0 1px 1px white;
        }
        .node.file .node-label {
            fill: #b3570e;
            font-weight: 700;
            text-decoration: underline wavy #f5b35c 2px;
            text-underline-offset: 5px;
        }
        .source-label {
            font-size: 22px;
            font-weight: 600;
            fill: #4e3a26;
        }
        .node.file:hover .node-circle {
            stroke: #ffdd99;
            stroke-width: 6px;
            filter: drop-shadow(0 0 15px #fdaa4b);
        }
        .node.file:hover .node-label {
            fill: #8e3f00;
        }
    </style>
</head>
<body>
<div class="tree-container">
    <svg width="1300" height="900"></svg>
</div>

<script>
    (function() {
        const svg = d3.select("svg");
        const width = +svg.attr("width");
        const height = +svg.attr("height");

        // ---------- æ–‡ä»¶ç›®å½•æ•°æ® (å¸¦ç±»å‹å’Œé“¾æ¥) ----------
        const data = {
            name: "æˆ‘çš„æ–‡ä»¶åº“",
            type: "directory",
            children: [
                {
                    name: "ğŸ“ æ–‡æ¡£",
                    type: "directory",
                    children: [
                        {
                            name: "ğŸ“ å·¥ä½œé¡¹ç›®",
                            type: "directory",
                            children: [
                                { name: "ğŸ“„ å¹´åº¦æ€»ç»“.docx", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" },
                                { name: "ğŸ“„ é¢„ç®—è¡¨.xlsx", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" }
                            ]
                        },
                        {
                            name: "ğŸ“ ä¸ªäººç¬”è®°",
                            type: "directory",
                            children: [
                                { name: "ğŸ“„ æ—¥è®°.txt", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" },
                                { name: "ğŸ“„ é£Ÿè°±.md", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" }
                            ]
                        },
                        { name: "ğŸ“„ è¯»ä¹¦æ¸…å•.txt", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" }
                    ]
                },
                {
                    name: "ğŸ“ å›¾ç‰‡",
                    type: "directory",
                    children: [
                        { name: "ğŸ“„ æ—…è¡Œ.jpg", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" },
                        { name: "ğŸ“„ ç”Ÿæ—¥.png", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" }
                    ]
                },
                {
                    name: "ğŸ“ éŸ³ä¹",
                    type: "directory",
                    children: [
                        { name: "ğŸ“„ å¤å¤©çš„é£.mp3", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" }
                    ]
                },
                { name: "ğŸ“„ è¯´æ˜.md", type: "file", url: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" }
            ]
        };

        // è½¬æ¢ä¸ºå±‚çº§æ•°æ®ï¼Œå¹¶å®šä¹‰ children è®¿é—®å™¨ï¼ˆä»…ç›®å½•ä¸”æœ‰å­èŠ‚ç‚¹æ—¶å±•å¼€ï¼‰
        const root = d3.hierarchy(data, function(d) {
            if (d.type === 'directory' && d.children && d.children.length > 0) {
                return d.children;
            }
            return null;
        });

        // ---------- è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„æ–‡ä»¶æ•°é‡ï¼ˆè‡ªèº«åŠåä»£ä¸­çš„æ–‡ä»¶ä¸ªæ•°ï¼‰----------
        function computeFileCount(node) {
            if (node.data.type === 'file') {
                node.fileCount = 1;
            } else {
                node.fileCount = 0;
            }
            if (node.children) {
                node.children.forEach(child => {
                    node.fileCount += computeFileCount(child);
                });
            }
            return node.fileCount;
        }
        computeFileCount(root);

        // æ‰¾å‡ºæœ€å¤§æ–‡ä»¶æ•°
        let maxFileCount = 0;
        root.links().forEach(link => {
            if (link.target.fileCount > maxFileCount) maxFileCount = link.target.fileCount;
        });
        if (maxFileCount === 0) maxFileCount = 1;

        const minWidth = 6;
        const maxWidth = 38;
        function getStrokeWidth(fileCount) {
            return minWidth + (fileCount / maxFileCount) * (maxWidth - minWidth);
        }

        // æ ‘å¸ƒå±€
        const treeLayout = d3.tree()
            .size([height - 150, width - 300])
            .separation((a, b) => (a.parent === b.parent ? 2.2 : 3.5));

        treeLayout(root);

        // ç»˜åˆ¶è¿çº¿ â€”â€” ç²—ç»†åŠ¨æ€ï¼Œå¹¶å·²é€šè¿‡CSSè·å¾—åœ†è§’æœ«ç«¯
        svg.selectAll(".link")
            .data(root.links())
            .enter()
            .append("path")
            .attr("class", "link")
            .attr("d", d3.linkHorizontal()
                .x(d => d.y)
                .y(d => d.x)
            )
            .attr("stroke-width", d => getStrokeWidth(d.target.fileCount));

        // ç»˜åˆ¶èŠ‚ç‚¹ç»„
        const nodes = svg.selectAll(".node")
            .data(root.descendants())
            .enter()
            .append("g")
            .attr("class", d => `node ${d.data.type || 'directory'}`)
            .attr("transform", d => `translate(${d.y},${d.x})`)
            .on("click", function(event, d) {
                if (d.data.type === 'file' && d.data.url) {
                    window.open(d.data.url, '_blank');
                }
                event.stopPropagation();
            });

        nodes.append("circle")
            .attr("class", d => d.depth === 0 ? "source-circle" : "node-circle")
            .attr("r", d => {
                if (d.depth === 0) return 22;
                return d.data.type === 'file' ? 16 : 14;
            });

        nodes.append("text")
            .attr("class", d => d.depth === 0 ? "source-label" : "node-label")
            .attr("dy", "0.35em")
            .attr("x", d => (d.children && d.children.length > 0) ? -30 : 30)
            .style("text-anchor", d => (d.children && d.children.length > 0) ? "end" : "start")
            .text(d => d.data.name);

        // æ ‡é¢˜å’Œè„šæ³¨
        svg.append("text")
            .attr("class", "title")
            .attr("x", 50)
            .attr("y", 50)
            .text("ğŸ“‚ æ–‡ä»¶æ•°é‡æƒé‡æ ‘ (åœ†è§’æç«¯)");

        svg.append("text")
            .attr("class", "subtitle")
            .attr("x", 50)
            .attr("y", 90)
            .text("ğŸ”— æ ‘å¹²ç²—ç»†ä»£è¡¨æ–‡ä»¶æ€»æ•°ï¼Œæœ«ç«¯åœ†è§’æ›´è‡ªç„¶");

        svg.append("text")
            .attr("class", "footer")
            .attr("x", 50)
            .attr("y", height - 30)
            .text("ğŸŒ³ æ–‡ä»¶æ•°é‡è¶Šå¤šè¿çº¿è¶Šç²—ï¼Œç‚¹å‡»ç¥ç€è‰²æ–‡ä»¶æ‰“å¼€ç¤ºä¾‹PDFã€‚");

        svg.append("text")
            .attr("class", "footer")
            .attr("x", width - 300)
            .attr("y", height - 30)
            .text(`ğŸ“Š æœ€å¤§æ–‡ä»¶æ•°: ${maxFileCount} (çº¿å®½ ${minWidth}~${maxWidth}px)`);
    })();
</script>

<div style="text-align: center; margin-top: 10px; color: #6b4f35; max-width:1300px;">
    âš¡ ç°åœ¨æ¯æ ¹æ ‘æçš„æœ«ç«¯éƒ½å˜æˆäº†åœ†è§’ï¼Œä¸æ ‘å¹²çš„è‡ªç„¶å½¢æ€æ›´å¥‘åˆã€‚
</div>
</body>
</html>